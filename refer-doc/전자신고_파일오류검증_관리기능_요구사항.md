# 전산매체 오류 검증 프로그램

> **TaxServiceENTEC-FEV** : Tax File Conversion Error Validation (세금 파일 변환 오류 검증)

---

## 1. 개요

### 1.1 목적

빈번한 오류 검증을 홈택스에 제출하지 않아도 형식/내용 오류 검증을 바로 수행한다.

### 1.2 오류 검증 절차

- 세금신고서의 내용이 일정한 형식의 전자신고 파일형태로 작성되어 제출됨
- 작성형식에 맞게 라인 단위 정보를 읽어 형식 오류 검증을 수행
- 파일을 읽어 법적인 내용을 점검하고 전자신고 파일설명서 대로 작성했는지 점검

### 1.3 핵심 강점

- **계산 근거의 투명성**: 단순 결과값이 아닌, 적용 조항과 오류 발생 부분, 산출 과정 등 상세한 **계산 근거(Worksheet)** 제공. 세무사가 고객을 설득하거나 세무서에 소명할 때 강력한 무기

---

## 2. 오류 검증 대상 세목

### 2.1 상세 구현 세목

- 부가가치세
- 종합소득세
- 원천세
- 법인세

### 2.2 개략적 구현 세목

- 양도소득세
- 증여세
- 상속세

---

## 3. 핵심 기능

### 3.1 실시간 법률 정보 업데이트 관리

- 개정 세법과 최신 판례, 유권해석을 가장 빠르게 로직에 반영
- 세법 변경 시 코드 수정 없이 설정값만으로 즉시 대응 가능한 룰엔진 구조

### 3.2 설계 반영 원칙

- 오류 점검 로직 구현 시 법개정에 유연한 설계 및 소스코드 반영이 용이하도록 상세 세액 계산 로직 구현

---

## 4. 개발 시 고려사항

### 4.1 DB 설계 요구사항

#### 4.1.1 주제영역 분류

| 분류 | 접두어 | 설명 | 예시 |
|------|--------|------|------|
| 기준정보 | `MST_` | 시스템 전반 참조 기초 데이터 | 사용자, 상품, 공용코드, 창고 |
| 요청/입력 | `REQ_` | 사용자 행위로 발생하는 동적 데이터 | 주문신청, 상담예약, 게시글 |
| 점검/결과 | `RES_` | 프로세스 완료 후 생성 데이터 | 검수결과, 정산내역, 성적표 |
| 관리/로그 | `HIS_` | 시스템 운영 및 이력 추적 데이터 | 접속로그, 변경이력, 권한설정 |

#### 4.1.2 명명 규칙

- 테이블: `{주제영역접두어}{업무명}` (단수형 사용)
- 컬럼 표준 약어: `ID`(식별자), `NM`(명칭), `DT`(일시), `CD`(코드), `YN`(여부), `AMT`(금액), `QTY`(수량), `DESC`(설명)

#### 4.1.3 PK 전략

- **기본**: `BIGINT AUTO_INCREMENT` (내부 참조용, 소량 기준정보)
- 인조키 생성규칙: 대문자만 허용, 년월일 8자리, 특수문자는 `-`만 허용
- 인조키 사용 최소화

#### 4.1.4 공통 감사 컬럼 (모든 테이블 필수)

```sql
reg_dt  DATETIME  NOT NULL  DEFAULT CURRENT_TIMESTAMP  -- 등록일시
reg_id  VARCHAR   NOT NULL                             -- 등록자
chg_dt  DATETIME            ON UPDATE CURRENT_TIMESTAMP -- 수정일시
chg_id  VARCHAR                                        -- 수정자
```

- 중요 정보(계약, 권한 등)는 `_HIS` 이력 테이블로 변경 전/후 스냅샷 관리

#### 4.1.5 데이터 타입 최적화

- 가변 문자열 → `VARCHAR` (현실적 최대 길이 산정)
- 상태코드 등 소범위 숫자 → `TINYINT` / `SMALLINT`
- 불필요하게 큰 타입 사용 금지

#### 4.1.6 인덱스 설계

- 선택도 높은 컬럼(ID, 이메일 등) 우선 인덱싱
- 복합 인덱스: `WHERE` 필터 조건 + `ORDER BY` 기준 순서로 배치
- 과도한 인덱스 지양 (CUD 성능 저하 방지)

#### 4.1.7 제약 조건

- 기본: `NOT NULL` 우선 적용
- 기본값: 등록일시(`CURRENT_TIMESTAMP`), 상태값(`0`) 등 설정
- 데이터 무결성은 DB 레벨에서 강제

#### 4.1.8 정규화

- 기본: 3차 정규화까지 적용
- 반정규화: 통계/대시보드 등 조회 성능 필요 시 요약 테이블 허용

#### 4.1.9 삭제 전략

- **Soft Delete**: `del_yn` 또는 `deleted_at` 컬럼 사용 (기본)
- **Hard Delete**: 개인정보 파기 등 법적 요구사항 시만 적용

#### 4.1.10 보안

- 민감 정보(비밀번호, 주민번호, 계좌번호) → 암호화 저장 (컬럼 길이 충분 확보)
- 민감 데이터는 별도 테이블 분리, 접근 권한 차별화

#### 4.1.11 코드화

- 텍스트 직접 저장 금지 → 공통코드 참조 (예: `'결제완료'` → `PAY_01`)
- 다국어/명칭 변경 대응 용이

#### 4.1.12 코멘트 필수

- 모든 테이블/컬럼에 비즈니스 의미를 담은 Comment 작성 필수

---

### 4.2 코딩 표준 요구사항

#### 4.2.1 주석 작성

- 클래스 주석: 목적, 역할, 작성자, 생성/수정 일자
- 메소드 주석: 역할(Role), 입력값(Parameter), 출력값(Return), 예외(Exception)

#### 4.2.2 단일 책임 원칙

- 함수/클래스는 한 가지 역할만 수행
- 50라인 이상 시 논리 단위로 분리

#### 4.2.3 예외 처리

- Null/빈값 체크 필수
- Try-Catch로 예외 처리, 에러 내용은 반드시 로그 기록

#### 4.2.4 하드코딩 금지

- DB 접속 정보, API 키, 파일 경로 등 → 환경 변수(`.env`) 또는 설정 파일(`config`)로 외부 관리

#### 4.2.5 보안

- 로그 출력 시 개인정보(비밀번호, 주민번호, 계좌번호) 마스킹 처리
- SQL Injection 방지 → Prepared Statement(파라미터 바인딩) 필수

#### 4.2.6 테스트 가능성

- 외부 상태 비의존 순수 함수 형태로 작성
- 단위 테스트(Unit Test) 용이한 구조 설계

#### 4.2.7 외부 라이브러리 관리

- 필요성 검토 후 추가, 무분별한 의존성 금지
- 버전 및 보안 취약점 주기적 점검

---

### 4.3 소스코드 개발환경 고려사항

#### 4.3.1 개발 언어 및 프레임워크

- Java 17 이상, Spring Boot 3.x
- Spring Web MVC, Spring Security, Spring Validation

#### 4.3.2 ORM / 데이터 접근

- JPA(Hibernate) 기본 사용, 복잡한 쿼리는 MyBatis 병행
- QueryDSL 선택적 적용 (동적 쿼리 필요 시)

#### 4.3.3 데이터베이스

- RDBMS: MySQL 8.x 또는 PostgreSQL 15.x
- 커넥션 풀: HikariCP (Spring Boot 기본 내장)

#### 4.3.4 빌드 및 의존성 관리

- Gradle (Kotlin DSL) 또는 Maven
- 의존성 버전은 Spring Boot BOM으로 통합 관리

#### 4.3.5 API 설계

- RESTful API 표준 준수
- API 문서화: Swagger(SpringDoc OpenAPI 3.x) 적용

#### 4.3.6 인증 및 인가

- JWT 기반 토큰 인증 (Access Token + Refresh Token)
- Spring Security 필터 체인으로 권한 제어

#### 4.3.7 로깅

- SLF4J + Logback
- 로그 레벨: ERROR > WARN > INFO > DEBUG (환경별 분리)
- 로그 포맷: `[일시][레벨][클래스명] 메시지` 통일

#### 4.3.8 환경 분리

- 프로파일: `local` / `dev` / `staging` / `prod`
- 환경별 설정: `application-{profile}.yml` 분리 관리

#### 4.3.9 형상 관리

- Git 사용, 브랜치 전략: Git Flow 또는 GitHub Flow
- 커밋 메시지: `[타입] 제목` 형식 (예: `[feat] 사용자 등록 API 추가`)

#### 4.3.10 테스트

- 단위 테스트: JUnit 5 + Mockito
- 통합 테스트: @SpringBootTest + TestContainers (DB 연동)
- 최소 커버리지 기준 설정 권장

#### 4.3.11 캐싱

- Spring Cache Abstraction 적용
- 캐시 구현체: Redis (세션 관리 겸용 가능)

#### 4.3.12 배포 및 컨테이너

- Docker 기반 컨테이너화, Dockerfile 표준화
- CI/CD: Jenkins 또는 GitHub Actions 파이프라인 구성

---

### 4.4 공통 영역 개발

#### 4.4.1 공통 엔티티/DTO

- 공통 엔티티/DTO 개발

#### 4.4.2 예외 처리 체계

- 개발자 예외처리 사항과 시스템 예외 처리 체계 개발

#### 4.4.3 공통 함수 (Common Functions)

- 비즈니스 로직 중 반복되는 부분 (로그 기록, 에러 핸들링, 데이터베이스 트랜잭션 처리 등)

#### 4.4.4 공통 상수/코드 (Constants & Global Codes)

- 시스템 전반에서 사용되는 고정값 (예: HTTP 상태 코드, 업무 구분 코드, 시스템 메시지 알림창 문구)
- 환경 변수 등

#### 4.4.5 유틸리티 함수 (Utility Functions)

특정 도메인에 종속되지 않는 범용적인 도구:

- 날짜/시간 포맷팅, 업연도/경정청구기한
- 문자열 조작, 사업자번호 포맷팅/마스킹
- 파일 입출력, 파일 업로드/삭제/검증
- 암복호화: AES 암복호화, SHA-256, Base64
- 유효성 검증(Regex), 정규식 검증/체크섬 검증
- 금액 포맷팅/절사/한글변환

#### 4.4.6 접근 권한 및 감사

- 신청인 이외 요청번호의 입력/결과물 접근 권한 관리
- 로깅/감사(Audit Log) 기능 개발

#### 4.4.7 UI 메시지 정의

- UI 알림 메시지, 오류 메시지, 사용자 메시지 등 정의

---

# TaxServiceENTEC-FEV Planning Document

> **Summary**: 세무프로그램에 종속되지 않는 독립 전자신고 파일 오류검증 시스템의 기능 요구사항 및 개발 계획
>
> **Project**: TaxServiceENTEC-FEV (Tax File Conversion Error Validation)
> **Version**: 1.1.0
> **Author**: Product Manager
> **Date**: 2026-02-19
> **Status**: Draft

---

## 1. Overview

### 1.1 Purpose

더존비즈온, 세무사랑 등 세무회계프로그램에서 생성된 전자신고 파일의 형식 오류 및 내용 오류를 홈택스 제출 전에 독립적으로 검증하는 범용 오류검증 엔진을 개발한다.

세무프로그램에 종속되지 않는 독립 검증 도구로서, 어떤 프로그램에서 생성된 전자신고 파일이든 국세청 표준 규격 기반으로 검증할 수 있는 시스템을 구축한다.

### 1.2 Background

현재 세무 시장에는 다음과 같은 문제가 존재한다.

- 각 세무프로그램(SmartA, 세무사랑, eTax 등)이 자체 생성 파일만 검증하며, 타 프로그램 파일 검증이 불가하다
- 검증 규칙이 소스코드에 하드코딩되어 세법 개정 대응이 느리다
- 오류 원인의 법적 근거 미제시 및 수정 가이드가 미흡하다
- 이미 생성된 전자신고 파일을 별도로 검증하는 독립 도구가 부재하다

형식 오류로 파일이 홈택스 접수 거부되면 무신고 가산세(납부세액 x 20%) 위험이 발생하고, 내용 오류로 세액이 과소 계산되면 과소신고 가산세(과소신고분 x 10%) + 납부지연 가산세(일수 x 0.022%)가 부과된다. FEV 시스템은 이 위험을 사전에 차단하는 것이 핵심 가치이다.

### 1.3 Legal Basis

| 법률 | 조항 | 핵심 내용 |
|------|------|----------|
| **국세기본법** | 제5조의2 | 국세정보통신망(홈택스) 이용 전자신고 근거 |
| **국세기본법 시행령** | 제3조의2 | 전자신고 방법, 절차, 프로그램 요건 |
| **부가가치세법** | 제48조, 제49조 | 부가세 확정/예정 신고 의무 |
| **소득세법** | 제70조 | 종합소득세 확정신고 의무 |
| **법인세법** | 제60조 | 법인세 과세표준 신고 의무 |
| **국세청 고시** | 전자신고·납부 고시 | 파일 포맷, 검증 규칙, 오류코드 체계 |

#### 오류 신고 시 가산세 체계

| 가산세 유형 | 세율/금액 | 법적 근거 |
|------------|----------|----------|
| 무신고가산세 (일반/부정) | 20% / 40% | 국세기본법 제47조의2 |
| 과소신고가산세 (일반/부정) | 10% / 40% | 국세기본법 제47조의3 |
| 납부지연가산세 | 미납세액 x 일수 x 0.022% | 국세기본법 제47조의4 |
| 세금계산서 미발급/부실기재 | 2% / 1% | 부가가치세법 제60조 |
| 전자세금계산서 미전송 | 0.5% | 부가가치세법 제60조 |
| 합계표 미제출 | 0.5% | 부가가치세법 제60조 |
| 성실신고확인서 미제출 | 산출세액 x 5% | 소득세법 제81조 |

#### 수정신고 가산세 감면

| 수정신고 시기 | 감면율 |
|-------------|--------|
| 1개월 이내 | 90% |
| 1~3개월 | 75% |
| 3~6개월 | 50% |
| 6개월~1년 | 30% |
| 1년~1년6개월 | 20% |
| 1년6개월~2년 | 10% |

#### 세무대리인 주의의무

| 책임 유형 | 근거 | 내용 |
|----------|------|------|
| 민사책임 | 민법 제681조 | 선관주의의무 위반 시 손해배상 |
| 행정책임 | 세무사법 제17조 | 고의/중과실 시 징계 (견책~등록취소) |
| 형사책임 | 조세범처벌법 제3조 | 부정행위 가담 시 2년 이하 징역 |

### 1.4 Related Documents

| 문서 | 경로 | 내용 |
|------|------|------|
| 핵심기능 요구사항 | `refer-doc/전자신고_파일오류검증_핵심기능_요구사항.md` | 세목별 검증규칙, 5단계 파이프라인, DB설계 |
| 관리기능 요구사항 | `refer-doc/전자신고_파일오류검증_관리기능_요구사항.md` | DB설계규칙, 코딩표준, 기술스택 |
| 기능요구사항/사용자 스토리 | `refer-doc/전자신고_파일오류검증_기능요구사항_사용자스토리.md` | FR상세, 사용자스토리 13건, MoSCoW, 흐름도 |

---

## 2. Scope

### 2.1 In Scope

- [x] 전자신고 파일 파서 엔진 (FR-001): 세목 자동 인식, EUC-KR/UTF-8 인코딩 감지, 합본 파일 분리, 고정길이 필드 파싱
- [x] 5단계 검증 파이프라인 (FR-002): L1 형식 -> L2 구조 -> L3 내용 -> L4 논리 -> L5 법규
- [x] 세목별 검증 모듈 (FR-003): 부가가치세(상세), 법인세(상세), 종합소득세(상세), 원천세(상세), 양도소득세(개략)
- [x] 검증 규칙 관리 시스템 (FR-004): DB 기반 규칙 외부화, 세율표/공제한도/레이아웃 버전 관리
- [x] 검증 결과 리포팅 (FR-005): 요약/상세/수정가이드/법적근거/PDF/Excel 출력
- [x] 공통 유틸리티 (FR-006): 체크디지트, 날짜, 인코딩, 단수처리, 개인정보 마스킹
- [x] 파일 뷰어 (FR-007): 레코드/필드 시각화, 오류 위치 하이라이트
- [x] 일괄처리 (FR-008): 복수 파일 일괄 검증, 합본 분리, 결과 대시보드
- [x] 관리자 기능: 검증 규칙 CRUD, 세율표 관리, 처리 현황 모니터링

### 2.2 Out of Scope

- 홈택스 직접 접수 연동 (국세청 보안 정책 제약)
- 더존/세무사랑 등 세무프로그램과의 직접 플러그인 연동
- 증여세/상속세 상세 구현 (처리 건수 극소, 복잡도 매우 높음 - Phase 4 이후 검토)
- AI 기반 오류 패턴 예측 (데이터 축적 후 Phase 4 이후 검토)
- 세법 개정 자동 감지 연동 (국세청 API 미공개)

---

## 3. Requirements

### 3.1 Functional Requirements

| ID | 요구사항 | 하위 요구사항 수 | Priority | Phase |
|----|---------|---------------|----------|-------|
| FR-001 | 파일 파서 엔진 | 10건 (FR-001-01~10) | High | 1 |
| FR-002-L1~L3 | 형식/구조/내용 검증 파이프라인 | 22건 (FR-002-01~22) | High | 1 |
| FR-003-VAT | 부가가치세 검증 모듈 | VAT-C 53건, VAT-L 8건, VAT-R 4건 | High | 1 |
| FR-004 | 검증 규칙/세율표/레이아웃 관리 | 7건 (FR-004-01~07) | High | 1 |
| FR-005-01~03,05 | 기본 리포팅 (요약, 상세, 수정가이드, 심각도) | 4건 | High | 1 |
| FR-006 | 공통 유틸리티 | 9건 (FR-006-01~09) | High | 1 |
| FR-002-L4~L5 | 논리/법규 검증 파이프라인 | 11건 (FR-002-23~33) | High | 2 |
| FR-003-CIT | 법인세 검증 모듈 | CIT-C 10건, CIT-L 6건, CIT2-E 40건 | High | 2 |
| FR-003-INC | 종합소득세 검증 모듈 | INC-C 6건, INC-L 10건, INC-T 5건 | High | 2 |
| FR-003-WHT | 원천세 검증 모듈 | WHT-C 9건, WHT-L 6건, WHT-Y 6건 | High | 2 |
| FR-003-CGT | 양도소득세 검증 모듈 (개략) | 7건 (FR-003-33~39) | Medium | 2 |
| FR-005-06~07 | 거래처별 분리 리포트, PDF/Excel 출력 | 2건 | Medium | 2 |
| FR-007 | 파일 뷰어 | 5건 (FR-007-01~05) | Medium | 3 |
| FR-008 | 일괄처리 | 4건 (FR-008-01~04) | Medium | 3 |
| FR-005-04,08 | 법적 근거 연결, 비교 리포트 | 2건 | Medium | 3 |

#### 세목별 검증규칙 수 통계

| 세목 | 서식코드 수 | 계산검증 | 교차검증 | 법규검증 | 오류코드 | 합계 |
|------|-----------|---------|---------|---------|---------|------|
| 부가가치세 | 21개 | 53건 | 8건 | 4건 | 19개 | 65건 |
| 법인세 | 34개 | 10건 | 6건 | 40건 | 20개+ | 56건 |
| 종합소득세 | 11 레코드 | 6건 | 10건 | 5건 | 15개+ | 21건 |
| 원천세 | 10개 | 9건 | 6건 | 6건 | 16개 | 21건 |
| **합계** | **76+** | **78건** | **30건** | **55건** | **70+** | **163건** |

### 3.2 Non-Functional Requirements

| 구분 | 기준 | 측정 방법 |
|------|------|---------|
| 성능 | 10MB 이하 단일 파일: 3초 이내 응답 | JMeter 부하 테스트 |
| 성능 | 100MB 이상 파일: 30초 이내 처리 (스트림) | 실환경 파일 테스트 |
| 성능 | 100개 파일 일괄: 5분 이내 완료 | 통합 테스트 |
| 보안 | 주민번호 뒤 6자리 마스킹 | 코드 리뷰 + 테스트 |
| 보안 | 검증 완료 후 원본 파일 즉시 삭제 또는 암호화 보관 | 보안 점검 |
| 보안 | JWT 기반 인증, 신청인 이외 결과 접근 불가 | Spring Security 설정 검증 |
| 보안 | 로그에 개인정보(주민번호, 계좌번호) 출력 금지 | 코드 리뷰 |
| 보안 | SQL Injection 방지 (Prepared Statement 필수) | 보안 점검 |
| 확장성 | 플러그인 구조로 신규 세목 추가 용이 | 아키텍처 리뷰 |
| 확장성 | DB 기반 규칙 추가 (코드 변경 없음) | 운영 배포 없이 규칙 추가 테스트 |
| 확장성 | 레코드 레이아웃 메타데이터 변경만으로 포맷 변경 대응 | 데이터 변경 테스트 |
| 운영 | 감사 로그 5년 보관 (HIS_VALIDATION_LOG) | 보관 정책 검증 |
| 운영 | 검증 건수/오류율/처리시간 통계 대시보드 | 모니터링 구현 검증 |

---

## 4. User Stories Summary

### 4.1 사용자 유형별 스토리 (총 13건)

| ID | 사용자 | 스토리 요약 | Phase |
|----|--------|-----------|-------|
| US-TAX-001 | 세무사 | 신고파일 제출 전 즉시 오류 검증 → 가산세 위험 사전 차단 | 1 |
| US-TAX-002 | 세무사 | 오류 원인(법적근거) + 수정 가이드 확인 → 정확한 수정/고객 설명 | 1 |
| US-TAX-003 | 세무사 | 검증 결과 PDF/Excel 출력 → 상담/소명 자료 활용 | 2 |
| US-TAX-004 | 세무사 | 파일 뷰어로 원시 데이터 확인 → 세무프로그램 없이 파일 검토 | 3 |
| US-BK-001 | 기장대리 | 대량 신고파일 일괄 검증 (최대 100개) → 신고 시즌 효율화 | 3 |
| US-BK-002 | 기장대리 | 합본 파일 거래처별 분리 검증 → 개별 오류 확인 | 2 |
| US-BK-003 | 기장대리 | 오류 거래처 필터링 → 수정 필요건 우선 처리 | 3 |
| US-DEV-001 | 개발사 | RESTful API로 파일 검증 연동 → 자체 프로그램 품질 자동 검증 | 2 |
| US-DEV-002 | 개발사 | 세목별 검증 규칙/오류코드 조회 → 파일 생성 로직 개선 참조 | 2 |
| US-ADM-001 | 관리자 | 검증 규칙 CRUD → 세법 개정 시 코드 배포 없이 즉시 반영 | 1 |
| US-ADM-002 | 관리자 | 세율표/공제한도 관리 → 매년 데이터 추가만으로 검증 로직 반영 | 1 |
| US-ADM-003 | 관리자 | 레코드 레이아웃 버전 관리 → 파일 규격 변경 대응 | 1 |
| US-ADM-004 | 관리자 | 검증 처리 현황 모니터링 → 시스템 상태/오류 패턴 분석 | 3 |

> 상세 인수조건(Acceptance Criteria)은 `refer-doc/전자신고_파일오류검증_기능요구사항_사용자스토리.md` 참조

---

## 5. Priority Matrix (MoSCoW)

### 5.1 Must (반드시 구현 - Phase 1 MVP)

| ID | 기능 | 근거 |
|----|------|------|
| FR-001-01~03, 06~10 | 파일 파서 엔진 핵심 기능 | 시스템 작동의 전제 조건 |
| FR-002-01~22 | L1~L3 검증 (형식/구조/내용) | 홈택스 접수 가능 여부 판단에 필수 |
| FR-003-VAT | 부가가치세 검증 모듈 | 신고 건수 1위 세목, 시장성 검증 |
| FR-004-01~06 | 검증 규칙/세율표/레이아웃 외부화 | 세법 개정 대응을 위한 필수 구조 |
| FR-005-01~03, 05 | 요약리포트, 상세오류, 수정가이드, 심각도 | 검증 결과 없이는 사용 불가 |
| FR-006-01~07, 09 | 공통 유틸리티 | 검증 로직의 핵심 구성요소 |

### 5.2 Should (중요 - Phase 2)

| ID | 기능 | 근거 |
|----|------|------|
| FR-002-23~33 | L4~L5 검증 (논리/법규) | 서식간 교차검증으로 실질 오류 탐지 |
| FR-003-CIT | 법인세 검증 모듈 (법인세-1/2) | 고부가가치 세목 |
| FR-003-INC | 종합소득세 검증 모듈 | 개인 납세자 대상 핵심 세목 |
| FR-003-WHT | 원천세 검증 모듈 | 월별 신고 빈도 높은 세목 |
| FR-003-CGT | 양도소득세 (개략) | 처리 건수 적지만 금액 큼 |
| FR-001-04~05 | 대용량/다중 파일 처리 | 기장대리 업무 지원 |
| FR-005-06~07 | 거래처 분리 리포트, PDF/Excel | 실무 활용도 향상 |
| FR-004-07 | 규칙 이력 관리 | 감사 추적성 확보 |

### 5.3 Could (있으면 좋음 - Phase 3)

| ID | 기능 | 근거 |
|----|------|------|
| FR-007-01~02, 04 | 파일 뷰어 (레코드/필드, 오류 하이라이트) | 전문가용 부가 기능 |
| FR-008-01~04 | 일괄처리 | 대규모 사용자 대상 |
| FR-005-04 | 법적 근거 연결 (가산세 위험 안내) | 사용자 경험 향상 |
| 크로스 세목 검증 | 부가세 매출 ↔ 법인세 수입금액 교차 | 고급 검증 기능 |

### 5.4 Won't (현재 범위 외 - Phase 4+)

| ID | 기능 | 사유 |
|----|------|------|
| AI 오류 패턴 분석 | 머신러닝 기반 오류 예측 | 데이터 축적 후 검토 |
| 세법 개정 자동 감지 | 국세청 RSS/API 연동 | API 제공 여부 미확인 |
| 홈택스 직접 접수 연동 | 검증 후 직접 제출 | 국세청 보안 정책 제약 |
| 세무프로그램 플러그인 | 더존/세무사랑 직접 연동 | 라이선스/보안 협의 필요 |
| 증여세/상속세 상세 | 상세 구현 | 처리 건수 극소, 복잡도 높음 |

---

## 6. Dependency Graph

### 6.1 Phase별 의존성

```
Phase 1: MVP (핵심 엔진 - 부가세 중심)
┌─────────────────────────────────────────────────────────┐
│  FR-004 (규칙/레이아웃 외부화)   ← 모든 기능의 선행 조건   │
│       ↓                                                 │
│  FR-001 (파일 파서 엔진)         ← FR-004 의존           │
│       ↓                                                 │
│  FR-006 (공통 유틸리티)          ← FR-002/003 의존       │
│       ↓                                                 │
│  FR-002 L1~L3 (형식/구조/내용)   ← FR-001, FR-006 의존   │
│       ↓                                                 │
│  FR-003 VAT (부가가치세)         ← FR-002 의존           │
│       ↓                                                 │
│  FR-005-01~03,05 (기본 리포팅)   ← FR-002, FR-003 의존   │
└─────────────────────────────────────────────────────────┘

Phase 2: 세목 확장
┌─────────────────────────────────────────────────────────┐
│  FR-002 L4~L5 (논리/법규)        ← Phase 1 완료 후       │
│  FR-003 CIT (법인세-1/-2)        ← Phase 1 완료 후       │
│  FR-003 INC (종합소득세)          ← Phase 1 완료 후       │
│  FR-003 WHT (원천세)             ← Phase 1 완료 후       │
│  FR-003 CGT (양도소득세 개략)     ← Phase 1 완료 후       │
│  FR-001-04~05 (대용량/다중 파일)  ← Phase 1 완료 후       │
│  FR-005-06~07 (거래처분리/PDF)    ← Phase 1 완료 후       │
└─────────────────────────────────────────────────────────┘

Phase 3: 고도화
┌─────────────────────────────────────────────────────────┐
│  FR-007 (파일 뷰어)              ← Phase 2 완료 후       │
│  FR-008 (일괄처리)               ← Phase 2 완료 후       │
│  FR-005-04 (법적근거 + 가산세)    ← Phase 2 완료 후       │
│  크로스 세목 검증                 ← Phase 2 완료 후       │
└─────────────────────────────────────────────────────────┘
```

### 6.2 기능 간 의존성 관계

| 기능 ID | 선행 의존 기능 | 의존 유형 |
|---------|-------------|---------|
| FR-001 | FR-004 (레이아웃 메타데이터) | 필수 |
| FR-002 L1~L3 | FR-001, FR-006 | 필수 |
| FR-002 L4~L5 | FR-002 L1~L3, FR-004 (세율표/공제한도) | 필수 |
| FR-003 (모든 세목) | FR-002 L1~L3 | 필수 |
| FR-003 CIT (법인세-2 교차) | FR-003 CIT (법인세-1) | 필수 |
| FR-005 | FR-002, FR-003 | 필수 |
| FR-007 | FR-001 | 필수 |
| FR-008 | FR-001, FR-002, FR-005 | 필수 |

---

## 7. Success Criteria

### 7.1 Definition of Done

- [ ] FR-001~FR-008 기능 요구사항 구현 완료
- [ ] 단위 테스트 (JUnit 5 + Mockito) 작성 및 통과
- [ ] 통합 테스트 (@SpringBootTest + TestContainers) 통과
- [ ] 코드 리뷰 완료
- [ ] API 문서 (Swagger OpenAPI 3.x) 작성 완료
- [ ] 성능 기준 (3초/30초/5분) 충족 검증

### 7.2 Quality Criteria

- [ ] 단위 테스트 커버리지 80% 이상 (검증 규칙 모듈 중점)
- [ ] 개인정보(주민번호, 계좌번호) 마스킹 100% 적용
- [ ] Fatal/Error/Warning 오류코드 분류 정확도 검증
- [ ] Phase별 세목 검증 규칙 100% 구현 및 테스트

### 7.3 Testing Strategy

| 테스트 유형 | 도구 | 대상 | 기준 |
|-----------|------|------|------|
| 단위 테스트 | JUnit 5 + Mockito | 검증 규칙 로직, 체크디지트, 단수처리 | 커버리지 80%+ |
| 통합 테스트 | @SpringBootTest + TestContainers | 파이프라인 전체 흐름, DB 연동 | 주요 시나리오 100% |
| 성능 테스트 | JMeter | 파일 크기별 응답시간, 동시 처리 | 3초/30초/5분 기준 |
| 보안 테스트 | OWASP ZAP, 코드 리뷰 | SQL Injection, XSS, 개인정보 노출 | 취약점 0건 |
| 검증 정확성 | 실제 신고 파일 샘플 | 세목별 검증 결과 정합성 | 홈택스 결과와 일치 |

---

## 8. Risks and Mitigation

| 위험 요소 | 영향도 | 발생가능성 | 대응방안 |
|----------|--------|---------|---------|
| 국세청 파일 포맷 변경 (XML/JSON 전환 논의) | High | Medium | 레코드 레이아웃 외부화로 데이터 변경만으로 대응 |
| 세법 개정에 따른 세율/공제한도 변경 | Medium | High | 귀속연도별 세율표/공제한도 DB 관리 |
| .doc 바이너리 파일 레코드 레이아웃 추출 | High | High | 파일설명서 텍스트 변환 작업 선행 |
| EUC-KR 인코딩 처리 오류 | High | Medium | 한글 2byte 처리 단위 테스트 충분히 확보 |
| 합본 파일 분리 로직 오류 | Medium | Medium | 다양한 합본 파일 샘플 기반 통합 테스트 |
| 대용량 파일 OOM | Medium | Low | 스트림 기반 처리 + 메모리 임계값 모니터링 |
| 가산세 계산 오류로 인한 신뢰성 저하 | High | Medium | 세무사 실무 검증, 홈택스 결과 비교 테스트 |

---

## 9. Architecture Considerations

### 9.1 Project Level Selection

| Level | Characteristics | Recommended For | Selected |
|-------|-----------------|-----------------|:--------:|
| Starter | Simple structure | Static sites | |
| Dynamic | Feature-based modules, BaaS | Web apps, SaaS MVPs | |
| Enterprise | Strict layer separation, DI, microservices | High-traffic, complex architectures | X |

Enterprise 레벨 선택 근거: 검증 규칙 플러그인 아키텍처, 세목별 모듈 분리, DI 기반 전략 패턴, 엄격한 레이어 분리(파서 / 검증 / 리포팅 / 관리)가 필요하기 때문이다.

### 9.2 Key Architectural Decisions

| 결정 사항 | 옵션 | 선택 | 근거 |
|---------|------|------|------|
| Backend Framework | Spring Boot 2.x / 3.x | Spring Boot 3.x | Java 17, Virtual Thread, Jakarta EE |
| 데이터 접근 | JPA / MyBatis / 혼합 | JPA + MyBatis 혼합 | 기본 CRUD: JPA, 복잡 집계: MyBatis |
| DB | MySQL / PostgreSQL | MySQL 8.x 또는 PostgreSQL 15.x | 운영 환경에 따라 선택 |
| 검증 규칙 엔진 | 하드코딩 / DB / 룰엔진 | DB 외부화 + Strategy 패턴 | 세법 개정 대응, 코드 변경 불필요 |
| 인증 | Session / JWT | JWT (Access + Refresh) | RESTful API 무상태 설계 |
| 캐싱 | None / In-Memory / Redis | Redis | 세율표/규칙 캐싱, DB 조회 최소화 |
| 테스트 | JUnit 4 / JUnit 5 | JUnit 5 + Mockito + TestContainers | Spring Boot 3.x 기본 지원 |
| 빌드 | Maven / Gradle | Gradle (Kotlin DSL) | Spring Boot BOM 통합 관리 |

### 9.3 Clean Architecture

```
Enterprise Level - 레이어드 아키텍처:

src/
├── presentation/         # Controller, DTO, Mapper
│   ├── api/              # REST API 컨트롤러
│   └── admin/            # 관리자 화면 API
├── application/          # UseCase, Service, Command/Query
│   ├── validation/       # 검증 파이프라인 서비스
│   ├── reporting/        # 리포팅 서비스
│   └── management/       # 규칙 관리 서비스
├── domain/               # 핵심 비즈니스 로직
│   ├── parser/           # 파일 파서 엔진 (Strategy 패턴)
│   │   ├── VatParser.java
│   │   ├── CitParser.java
│   │   ├── IncParser.java
│   │   └── WhtParser.java
│   ├── validator/        # 검증 파이프라인 (Chain of Responsibility)
│   │   ├── level1/       # 형식검증
│   │   ├── level2/       # 구조검증
│   │   ├── level3/       # 내용검증
│   │   ├── level4/       # 논리검증
│   │   └── level5/       # 법규검증
│   ├── taxmodule/        # 세목별 검증 모듈
│   │   ├── vat/          # 부가가치세
│   │   ├── cit/          # 법인세
│   │   ├── inc/          # 종합소득세
│   │   └── wht/          # 원천세
│   └── model/            # 도메인 엔티티/VO
├── infrastructure/       # DB, 파일 I/O, 외부 연동
│   ├── persistence/      # JPA Entity, Repository, MyBatis Mapper
│   ├── fileio/           # 파일 업로드/스트림 처리
│   └── cache/            # Redis 캐시 설정
└── common/               # 공통 모듈
    ├── util/             # 유틸리티 (체크디지트, 날짜, 인코딩, 마스킹)
    ├── exception/        # 공통 예외 처리
    └── config/           # 시스템 설정
```

### 9.4 API Endpoint Pattern

| 리소스 | Method | Endpoint | 설명 |
|--------|--------|----------|------|
| 파일 검증 | POST | `/api/v1/validations` | 파일 업로드 및 검증 요청 |
| 검증 결과 | GET | `/api/v1/validations/{id}` | 검증 결과 조회 |
| 검증 결과 상세 | GET | `/api/v1/validations/{id}/details` | 오류 상세 목록 |
| 리포트 다운로드 | GET | `/api/v1/validations/{id}/report` | PDF/Excel 내보내기 |
| 일괄 검증 | POST | `/api/v1/validations/batch` | 복수 파일 일괄 검증 |
| 검증 규칙 | GET/POST/PUT | `/api/v1/admin/rules` | 규칙 CRUD |
| 세율표 | GET/POST/PUT | `/api/v1/admin/tax-rates` | 세율표 관리 |
| 레이아웃 | GET/POST/PUT | `/api/v1/admin/layouts` | 레코드 레이아웃 관리 |
| 코드 관리 | GET/POST/PUT | `/api/v1/admin/codes` | 공통코드 관리 |
| 모니터링 | GET | `/api/v1/admin/dashboard` | 처리 현황 통계 |
| 인증 | POST | `/api/v1/auth/login` | 로그인 (JWT 발급) |
| 인증 | POST | `/api/v1/auth/refresh` | 토큰 갱신 |

---

## 10. Convention Prerequisites

### 10.1 Existing Project Conventions

- [x] 관리기능 요구사항서에 DB 설계 요구사항 (4.1) 및 코딩 표준 (4.2) 정의됨
- [x] Java 17 + Spring Boot 3.x 기술 스택 확정
- [x] 테이블 접두어: MST_ / REQ_ / RES_ / HIS_
- [x] 오류코드 체계: {세목}-{레벨}{번호} (예: VAT-C001, CIT-L001)
- [x] 공통 감사 컬럼 정의: reg_dt, reg_id, chg_dt, chg_id

### 10.2 Conventions to Define/Verify

| 구분 | 현황 | 정의 필요 사항 | 우선순위 |
|------|------|-------------|---------|
| 테이블 명명 | MST_/REQ_/RES_/HIS_ 접두어 정의됨 | 세부 테이블명 확정 | High |
| 오류코드 체계 | {세목}-{레벨}{번호} 형식 정의됨 | 전체 오류코드 목록 완성 | High |
| 검증 규칙 ID | 예: VAT-C001, CIT-L001 형식 정의됨 | 미정의 세목 규칙 ID 체계 수립 | High |
| API URL 패턴 | RESTful 준수 | `/api/v1/{resource}` 패턴 확정 | Medium |
| 환경변수 | 미정의 | DB URL, JWT Secret, 파일 저장 경로 | Medium |
| 예외 처리 패턴 | 코딩 표준에 정의 | 비즈니스/시스템 예외 클래스 계층 확정 | Medium |
| 로깅 포맷 | [일시][레벨][클래스명] 정의 | MDC 활용 요청ID 추적 패턴 확정 | Medium |

### 10.3 Environment Variables

| 변수 | 목적 | 범위 |
|------|------|------|
| `DB_URL` | DB 연결 문자열 | Server |
| `DB_USERNAME` | DB 계정 | Server |
| `DB_PASSWORD` | DB 비밀번호 | Server |
| `JWT_SECRET` | JWT 서명 키 | Server |
| `JWT_ACCESS_EXPIRATION` | Access Token 만료 시간 | Server |
| `JWT_REFRESH_EXPIRATION` | Refresh Token 만료 시간 | Server |
| `FILE_UPLOAD_PATH` | 파일 업로드 임시 경로 | Server |
| `FILE_RETENTION_SECONDS` | 검증 완료 후 파일 보관 시간 | Server |
| `FILE_MAX_SIZE` | 최대 업로드 파일 크기 | Server |
| `REDIS_HOST` | Redis 서버 주소 | Server |
| `REDIS_PORT` | Redis 서버 포트 | Server |

### 10.4 DB Schema Overview

```
[기준정보 MST_]
├── MST_TAX_TYPE          # 세목 마스터
├── MST_FORM_CODE         # 서식코드 마스터
├── MST_RECORD_LAYOUT     # 레코드 레이아웃 메타데이터
├── MST_FIELD_LAYOUT      # 필드 레이아웃 메타데이터
├── MST_VALIDATION_RULE   # 검증 규칙 마스터
├── MST_TAX_RATE          # 세율표 (귀속연도별)
├── MST_DEDUCTION_LIMIT   # 공제/감면 한도표
├── MST_CODE              # 공통코드
└── MST_ERROR_CODE        # 오류코드 정의

[요청 REQ_]
├── REQ_VALIDATION        # 검증 요청
└── REQ_VALIDATION_FILE   # 검증 대상 파일

[결과 RES_]
├── RES_VALIDATION_RESULT # 검증 결과 요약
├── RES_VALIDATION_DETAIL # 검증 결과 상세 (오류 목록)
└── RES_VALIDATION_REPORT # 검증 리포트

[이력 HIS_]
├── HIS_VALIDATION_LOG    # 검증 처리 로그
└── HIS_RULE_CHANGE       # 규칙 변경 이력
```

---

## 11. Next Steps

1. [x] 기능 요구사항 및 사용자 스토리 문서 작성 완료
2. [ ] **프로그램 설계서 작성** (`docs/02-design/features/tax-file-error-validation.design.md`)
   - DB 테이블 상세 설계 (MST_*/REQ_*/RES_*/HIS_* 전체 DDL)
   - API 명세 (엔드포인트/요청/응답 상세)
   - 검증 파이프라인 클래스 다이어그램
   - 세목별 검증 모듈 상세 설계
3. [ ] Phase 1 MVP 구현 시작
4. [ ] 국세청 파일설명서(.doc) 텍스트 추출 및 레코드 레이아웃 JSON 변환
5. [ ] 팀 리뷰 및 CTO 승인

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 0.1 | 2026-02-19 | Initial draft (FR-001~008 기능 요구사항 분석, Phase별 로드맵, 아키텍처 방향 정의) | Product Manager |
| 1.1 | 2026-02-19 | 보완: 법적근거(1.3), 사용자스토리 요약(4), MoSCoW 매트릭스(5), 의존성 그래프(6), 테스트 전략(7.3), API 패턴(9.4), DB 스키마(10.4), 세목별 검증규칙 통계, 비기능 보안 항목 추가 | Claude |
